---
import NavLink from './NavLink.astro';
import siteConfig from '../data/site-config';
import ThemeToggle from './ThemeToggle.astro';
import Home from '../icons/Home.astro';

const navLinks = siteConfig.headerNavLinks || [];
---

<nav class="pt-6 pb-6 sm:pb-8 border-b border-main border-opacity-10">
  <div
    class="max-w-full lg:max-w-5xl mx-auto relative flex items-center justify-between"
  >
    <a
      href="/"
      class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-main hover:scale-105 transition-all duration-200"
      aria-label="Home"
    >
      <Home class="text-main" />
    </a>

    <div class="flex items-center gap-6">
      {
        navLinks.length > 0 && (
          <>
            <button
              class="menu-toggle w-8 h-8 flex items-center justify-center relative z-30 md:hidden"
              aria-label="Open Menu"
              aria-expanded="false"
              aria-controls="menu-items"
            >
              <span class="menu-toggle-icon w-6 h-px relative bg-current" />
            </button>
            <ul id="menu-items" class="menu flex gap-8">
              {navLinks.map((link) => (
                <li>
                  <NavLink
                    class="text-lg font-sans font-medium text-main hover:opacity-70 transition-opacity duration-200"
                    href={link.href}
                  >
                    {link.text}
                  </NavLink>
                </li>
              ))}
            </ul>
          </>
        )
      }
      <div class="z-10">
        <ThemeToggle />
      </div>
    </div>
  </div>
</nav>

<style>
  @media (max-width: 767px) {
    .menu {
      @apply flex-col gap-4 absolute top-14 right-0 w-48 px-6 py-6 z-20 bg-main border-2 border-main rounded-lg shadow-lg invisible opacity-0;
    }
    .menu.is-visible {
      @apply visible opacity-100;
      transition: opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
    }
    .menu-toggle-icon {
      transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
    }
    .menu-toggle.is-active .menu-toggle-icon {
      @apply w-0;
      transition: width 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .menu-toggle-icon:before,
    .menu-toggle-icon:after {
      @apply w-6 h-px absolute left-1/2 top-0 origin-center -translate-x-1/2 bg-current;
      content: '';
      transition:
        transform 0.2s cubic-bezier(0.4, 0, 0.2, 1),
        margin 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.2s;
    }
    .menu-toggle-icon:before {
      @apply -mt-1.5;
    }
    .menu-toggle-icon:after {
      @apply mt-1.5;
    }
    .menu-toggle.is-active .menu-toggle-icon:before,
    .menu-toggle.is-active .menu-toggle-icon:after {
      @apply mt-0;
      transition:
        margin 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.1s,
        transform 0.2s cubic-bezier(0.4, 0, 0.2, 1) 0.3s;
    }
    .menu-toggle.is-active .menu-toggle-icon:before {
      @apply rotate-45;
    }
    .menu-toggle.is-active .menu-toggle-icon:after {
      @apply -rotate-45;
    }
  }
</style>

<script>
  function menuToggle() {
    const menu = document.querySelector('.menu');
    const menuToggleBtn = document.querySelector('.menu-toggle');
    menuToggleBtn?.addEventListener('click', () => {
      const isMenuExpanded =
        menuToggleBtn.getAttribute('aria-expanded') === 'true';
      menuToggleBtn.classList.toggle('is-active');
      menuToggleBtn.setAttribute(
        'aria-expanded',
        isMenuExpanded ? 'false' : 'true'
      );
      menuToggleBtn.setAttribute(
        'aria-label',
        isMenuExpanded ? 'Open Menu' : 'Close Menu'
      );
      menu?.classList.toggle('is-visible');
    });
  }
  menuToggle();
  document.addEventListener('astro:after-swap', menuToggle);
</script>
