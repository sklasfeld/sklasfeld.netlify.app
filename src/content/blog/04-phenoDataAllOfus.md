---
title: 'All of Us Has Cohort Builders. I Chose SQL Chaos Instead.'
excerpt: 'How to Load Phenotype Data in All of Us'
publishDate: 'Dec 4 2025'
tags:
  - biobank
  - all-of-us
  - omop
  - athena
  - ehr-data
  - phenotype-data
draft: true
seo:
  image:
    src: '/blog_images/biobank1/source_to_standard_omop.png'
    alt: 'Flowchart showing the process of transforming hospital EHR data into OMOP format.'
---

<figure>
<img src="/blog_images/biobank1/source_to_standard_omop.png" alt="Flowchart showing the process of transforming hospital EHR data into OMOP format." class="block dark:hidden">
<img src="/blog_images/biobank1/source_to_standard_omop_dark.png" alt="Flowchart showing the process of transforming hospital EHR data into OMOP format." class="hidden dark:block">
<figcaption class="text-center text-sm opacity-80 mt-2">
   <strong>Image 4:</strong> <em>EHR to OMOP Flowchart. Raw hospital data with inconsistent coding is extracted, transformed into standardized concepts through the OMOP vocabulary, and loaded into relational tables for research use.</em>
 </figcaption>
</figure>

Similar to the UK Biobank Showcase, the All of Us Research Hub provides a [data browser](https://databrowser.researchallofus.org/) for exploring available phenotype data. Data collected by All of Us originates from multiple sources including self-reported surveys, program enrollment visits, and electronic health records (EHRs). EHRs are either collected from the participant or from their affiliated health care organization. From these different extraction points the data is transformed and loaded into the [OMOP common data model structure](https://support.researchallofus.org/hc/en-us/articles/360039585391-Understanding-OMOP-Basics).

All of Us stores much of its data in BigQuery tables which can be accessed with BigQuery SQL. However, to get started with the clinical data, All of Us recommends starting with their [Cohort and Dataset Builders](https://www.researchallofus.org/data-tools/workbench/), point-and-click tools for navigating the data. The Cohort and Dataset Builders work in two stages: first, you define your cohort by specifying inclusion criteria that limit your participant set. Then, you build your dataset by selecting that cohort and choosing which concept sets and values to extract. Once configured, clicking "Analyze" â†’ "See Code Preview" reveals the underlying BigQuery SQL generated by your selections. While I find the Builders limiting compared to writing custom queries, the builder provides a streamlined interface for discovering what phenotype data is available in the biobank.

To write the custom SQL queries needed for my analyses, I honestly relied on my own knowledge of SQL and AI chatbots. If you go to the home page for OMOP they show you a diagram of words with arrows going in a tangled mess. So let's break it down. Within the BigQuery SQL database there are the tables including person, observation, condition_occurance, death, visit_occurance, procedure_occurance, measurement, etc. These tables are all listed on the left scrollable box in the [OMOP CDM v5.4 documentation](https://ohdsi.github.io/CommonDataModel/cdm53.html). The `person_id` field can be found in all of these tables. It is a foreign key, which means it may not always be unique within a table, but it can be used to establish relationships between tables.

OMOP data model and [OMOP Athena Vocabulary](https://athena.ohdsi.org/) to identify relevant concept IDs. The Athena Vocabulary is a web-based tool for searching and exploring the standardized concepts used in OMOP. For example, if I'm interested in extracting systolic blood pressure measurements, I can search for "systolic blood pressure" in Athena to find the corresponding concept ID (e.g., 3004249). I can then use this concept ID in my SQL queries to pull the relevant data from the All of Us OMOP tables.
